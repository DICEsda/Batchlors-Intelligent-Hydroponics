<div class="alerts-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-left">
      <a routerLink="/overview" hlmBtn variant="ghost" size="icon" class="back-btn">
        <ng-icon hlmIcon name="lucideArrowLeft" size="sm" />
      </a>
      <div class="header-content">
        <div class="title-row">
          <h1 class="page-title">Coordinator Logs</h1>
        </div>
        <p class="page-description">Monitor real-time logs from reservoir coordinators</p>
      </div>
    </div>
    <div class="header-actions">
      @if (usingMockData()) {
        <span hlmBadge variant="outline" class="mock-badge">Mock Data</span>
      }
      <button
        hlmBtn
        variant="outline"
        size="sm"
        (click)="refreshData()"
        [disabled]="isLoading()"
      >
        <ng-icon
          hlmIcon
          name="lucideRefreshCw"
          size="sm"
          [class.animate-spin]="isLoading()"
        />
        <span>Refresh</span>
      </button>
    </div>
  </header>

  <!-- Error Banner -->
  @if (error()) {
    <div class="error-banner">
      <ng-icon hlmIcon name="lucideAlertTriangle" size="sm" />
      <span>{{ error() }}</span>
      <button hlmBtn variant="ghost" size="sm" (click)="refreshData()">Retry</button>
    </div>
  }

  <!-- Coordinator Logs Card -->
  <div hlmCard class="log-card">
    <div class="log-card-header">
      <div class="header-left-content">
        <ng-icon hlmIcon name="lucideServer" size="lg" class="card-icon coordinator-icon" />
        <div>
          <h2 hlmCardTitle>Coordinator System Logs</h2>
          <p hlmCardDescription>
            @if (selectedCoordinatorId() === '') {
              Monitoring all coordinators
            } @else if (selectedCoordinator()) {
              Monitoring {{ selectedCoordinator()?.name || selectedCoordinator()?.coord_id }}
            } @else {
              Real-time diagnostic and operational logs from reservoir coordinators
            }
          </p>
        </div>
      </div>
      <div class="header-right-content">
        <!-- WebSocket Connection Status -->
        <div class="connection-status">
          @if (wsService.connected()) {
            <span class="status-indicator status-connected">‚óè Live</span>
          } @else if (wsService.connecting()) {
            <span class="status-indicator status-connecting">‚óè Connecting...</span>
          } @else {
            <span class="status-indicator status-disconnected">‚óè Disconnected</span>
          }
        </div>
      </div>
    </div>

    <!-- Coordinator Selector -->
    <div class="coordinator-selector">
      <span class="selector-label">Source:</span>
      <button class="coord-pill"
              [class.active]="selectedCoordinatorId() === ''"
              (click)="selectCoordinator('')">
        All
      </button>
      @for (coord of coordinators(); track coord._id) {
        <button class="coord-pill"
                [class.active]="selectedCoordinatorId() === coord._id || selectedCoordinatorId() === coord.coord_id"
                (click)="selectCoordinator(coord._id)">
          <span class="coord-dot" [style.background]="$any(coord).color || '#3b82f6'"></span>
          {{ coord.name || coord.coord_id }}
        </button>
      }
    </div>
    
    <!-- Log Controls -->
    <div class="log-controls">
      <!-- Log Level Filters -->
      <div class="filter-group">
        <span class="filter-label">Levels:</span>
        <button
          hlmBtn
          variant="outline"
          size="sm"
          [class.active]="logLevelFilter().includes('DEBUG')"
          (click)="toggleLogLevel('DEBUG')"
        >
          DEBUG
        </button>
        <button
          hlmBtn
          variant="outline"
          size="sm"
          [class.active]="logLevelFilter().includes('INFO')"
          (click)="toggleLogLevel('INFO')"
        >
          INFO
        </button>
        <button
          hlmBtn
          variant="outline"
          size="sm"
          [class.active]="logLevelFilter().includes('WARN')"
          (click)="toggleLogLevel('WARN')"
        >
          WARN
        </button>
        <button
          hlmBtn
          variant="outline"
          size="sm"
          [class.active]="logLevelFilter().includes('ERROR')"
          (click)="toggleLogLevel('ERROR')"
        >
          ERROR
        </button>
      </div>
      
      <!-- Clear Logs Button -->
      <button
        hlmBtn
        variant="ghost"
        size="sm"
        (click)="clearLogs()"
        [disabled]="coordinatorLogs().length === 0"
      >
        <ng-icon hlmIcon name="lucideTrash2" size="sm" />
        <span>Clear</span>
      </button>
    </div>
    <div class="log-content">
      @if (coordinatorLogs().length > 0) {
        <div class="logs-container" #logsContainer (scroll)="onLogsScroll()">
          @for (log of coordinatorLogs(); track trackByIndex($index)) {
            <div class="log-entry" 
                 [class.log-debug]="log.includes('[DEBUG]')" 
                 [class.log-info]="log.includes('[INFO]')"
                 [class.log-warn]="log.includes('[WARN]')"
                 [class.log-error]="log.includes('[ERROR]')"
                 [class.connection-event]="log.includes('üì∂') || log.includes('üì°') || log.includes('üìµ') || log.includes('üî¥') || log.includes('üåê') || log.includes('‚ö†Ô∏è')">{{ log }}</div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <ng-icon name="lucideClock" size="48" />
          <p>Waiting for log messages...</p>
          <small class="text-muted">Logs will appear here in real-time as they are generated by the coordinator.</small>
        </div>
      }
    </div>
  </div>
</div>
